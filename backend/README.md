# Fullstack Starter Template - Backend

Готовый к использованию шаблон backend приложения для быстрого старта fullstack-проектов. Этот проект создан как переиспользуемый шаблон, включающий современный стек технологий и лучшие практики разработки.

---

## Содержание

- [1. Обзор компонентов](#1-обзор-компонентов)
- [2. Архитектура системы](#2-архитектура-системы)
- [3. Конфигурация](#3-конфигурация)
- [4. Запуск сервиса](#4-запуск-сервиса)
- [5. Тестирование](#5-тестирование)
- [6. Стандарты кодирования](#6-стандарты-кодирования)
- [7. Устранение неполадок](#7-устранение-неполадок)
- [8. Безопасность](#8-безопасность)

---

## **_1. Обзор компонентов_**

Это сервис на NestJS + TypeScript для построения масштабируемых backend приложений. Он включает:

- **NestJS** - Прогрессивный Node.js фреймворк для построения эффективных и масштабируемых серверных приложений
- **Prisma ORM** - Современный ORM для работы с базой данных PostgreSQL
- **Swagger/OpenAPI** - Автоматическая генерация API документации
- **JWT** - Аутентификация на основе токенов
- **TypeScript** - Типизированный JavaScript для повышения надежности кода

---

## **_2. Архитектура системы_**

### Технологический стек

- **NestJS** - Прогрессивный Node.js фреймворк, вдохновленный Angular
- **TypeScript** - Типизированный JavaScript
- **Prisma** - Современный ORM для работы с базой данных
- **PostgreSQL** - Реляционная база данных
- **Swagger/OpenAPI** - Автоматическая генерация API документации
- **JWT** - Аутентификация на основе токенов
- **Jest** - Фреймворк для тестирования

### Структура проекта

```
backend/
├── src/
│   ├── app.module.ts        # Главный модуль приложения
│   └── main.ts              # Точка входа
├── prisma/
│   └── schema.prisma        # Схема базы данных
├── Dockerfile               # Docker образ для backend
├── package.json
└── tsconfig.json
```

---

## **_3. Конфигурация_**

Настройки приложения настраиваются в основном через переменные окружения. Создайте файл `.env` в директории `backend/`:

```env
# База данных
DATABASE_URL="postgresql://user:password@localhost:5432/dbname"

# Сервер
PORT=3000
NODE_ENV=development

# JWT
JWT_SECRET=your-secret-key-change-in-production
JWT_EXPIRES_IN=24h

# CORS
CORS_ORIGIN=http://localhost:5173
```

### Ключевые области конфигурации:

- **База данных**: подключение Prisma/PostgreSQL через `DATABASE_URL`
- **Аутентификация**: JWT секреты и настройки токенов
- **CORS**: Настройка разрешенных источников для frontend
- **Логирование**: Уровни логирования и конфигурация

---

## **_4. Запуск сервиса_**

### Настройка проекта

```bash
# Установка зависимостей
npm install
```

### Компиляция и запуск проекта

```bash
# Development режим с hot reload
npm run start:dev

# Production режим
npm run start:prod

# Debug режим
npm run start:debug
```

### Prisma - Работа с базой данных

```bash
# Установка Prisma и Client (если еще не установлены)
npm install prisma --save-dev
npm install @prisma/client

# Инициализация Prisma (если еще не инициализирован)
npx prisma init

# После редактирования schema.prisma → Создать миграцию
npx prisma migrate dev --name init

# Применить схему к БД без истории миграций (опционально, только для разработки)
npx prisma db push

# Генерация Prisma Client (выполнять после каждого изменения схемы)
npx prisma generate

# Открыть Prisma Studio (GUI для просмотра и редактирования данных)
npx prisma studio
```

### API Документация

После запуска backend, Swagger документация доступна по адресу:
- **Development**: http://localhost:3000/api/docs

API использует JWT аутентификацию. Для тестирования защищенных endpoints используйте кнопку "Authorize" в Swagger UI.

---

## **_5. Тестирование_**

### Запуск тестов

```bash
# Unit тесты
npm run test

# Unit тесты в watch режиме
npm run test:watch

# E2E тесты
npm run test:e2e

# Покрытие кода тестами
npm run test:cov
```

### Структура тестов

- **Unit тесты**: Тестирование отдельных модулей, сервисов и контроллеров
- **E2E тесты**: Полное тестирование приложения с тестовой базой данных
- **Integration тесты**: Тестирование взаимодействия между компонентами

---

## **_6. Стандарты кодирования_**

Проект следует лучшим практикам разработки на NestJS и TypeScript. Ключевые инструменты:

- **ESLint** - Линтинг кода
- **Prettier** - Форматирование кода
- **Jest** - Тестирование

### Линтинг

#### Запуск линтинга

Проверяет ваш код на стилистические и типовые проблемы с помощью ESLint:

```bash
npm run lint
```

#### Автоматическое исправление ошибок линтинга

Автоматически исправляет исправимые проблемы линтинга и форматирования:

```bash
npm run fix
```

Или отдельно:

```bash
npm run fix:eslint      # Исправить проблемы ESLint
npm run fix:prettier    # Форматировать код Prettier
```

### Форматирование

#### Форматирование кода с помощью Prettier

```bash
npm run format
```

Или напрямую:

```bash
npx prettier --write "src/**/*.ts" "test/**/*.ts"
```

### Примечания

- Исправляйте все ошибки линтинга и форматирования перед коммитом кода
- Если вы добавляете новые зависимости или скрипты, обновляйте этот README соответственно
- Для настройки окружения создайте `.env` файл на основе примеров выше

---

## **_7. Устранение неполадок_**

### Частые проблемы

**TypeScript предупреждения об использовании `any`**
- Добавьте правильные типы для всех переменных и функций
- Используйте `unknown` вместо `any` где это возможно

**Prettier или ESLint ведут себя неожиданно**
- Проверьте ваши файлы конфигурации (`eslint.config.mjs`, `.prettierrc`)
- Убедитесь, что все зависимости установлены

**Проблемы с подключением к базе данных**
- Проверьте `DATABASE_URL` в `.env` файле
- Убедитесь, что PostgreSQL запущен и доступен
- Проверьте права доступа пользователя базы данных

**Prisma Client не обновляется**
- Выполните `npx prisma generate` после изменения схемы
- Убедитесь, что миграции применены: `npx prisma migrate dev`

---

## **_8. Безопасность_**

### Рекомендации по безопасности

- **Никогда не коммитьте `.env` файл** или секреты в систему контроля версий
- **Используйте сильные секретные ключи** для JWT в продакшене
- **Настройте правильные CORS политики** для вашего frontend
- **Валидация входных данных**: Используйте `class-validator` для всех DTO
- **Регулярно обновляйте зависимости** для получения исправлений безопасности
- **Используйте HTTPS** в продакшене
- **Настройте мониторинг и логирование** для отслеживания подозрительной активности

### Переменные окружения

Все секреты и конфигурация должны храниться в `.env` файлах:
- `.env` - для разработки (не коммитится)
- `.env.example` - шаблон с примерами (коммитится)
- `.env.production` - для продакшена (не коммитится)

---

## Использование как шаблона

Этот backend шаблон создан для переиспользования. Чтобы адаптировать его под ваш проект:

1. **Обновите метаданные**
   - Измените `name` в `package.json`
   - Обновите `description` и `author`

2. **Настройте базу данных**
   - Отредактируйте `prisma/schema.prisma` под ваши нужды
   - Выполните миграции: `npx prisma migrate dev`

3. **Настройте переменные окружения**
   - Создайте `.env` файл с вашими настройками
   - Обновите `DATABASE_URL`, `JWT_SECRET` и другие параметры

4. **Начните разработку!**
   - Добавьте свои модули в `src/`
   - Создайте контроллеры, сервисы и DTO
   - Настройте маршрутизацию и middleware

---

## Ресурсы

### Документация

- [NestJS Documentation](https://docs.nestjs.com/)
- [Prisma Documentation](https://www.prisma.io/docs)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/)
- [Jest Documentation](https://jestjs.io/docs/getting-started)

---

Nest лицензирован под [MIT](https://github.com/nestjs/nest/blob/master/LICENSE).

---

**Примечание**: Этот шаблон создан для быстрого старта новых проектов. Не забудьте настроить все переменные окружения и обновить метаданные проекта перед использованием в продакшене.
